# Create a network for Kafka
podman network create kafka-net

# Start Kafka broker/controller node #1
podman run -d --name kafka1 --network kafka-net --hostname kafka1 -p 9092:9092 \
  -e KAFKA_NODE_ID=1 \
  -e KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER \
  -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT \
  -e KAFKA_LISTENERS=INTERNAL://kafka1:29092,CONTROLLER://kafka1:29093,EXTERNAL://0.0.0.0:9092 \
  -e KAFKA_ADVERTISED_LISTENERS=INTERNAL://kafka1:29092,EXTERNAL://localhost:9092 \
  -e KAFKA_INTER_BROKER_LISTENER_NAME=INTERNAL \
  -e KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka1:29093 \
  -e KAFKA_PROCESS_ROLES=broker,controller \
  -e KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0 \
  -e KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1 \
  -e KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1 \
  -e CLUSTER_ID=ciWo7IWazngRchmPES6q5A== \
  -e KAFKA_LOG_DIRS=/tmp/kraft-combined-logs \
  confluentinc/cp-kafka:latest

# Start Kafka broker/controller node #2
podman run -d --name kafka2 --network kafka-net --hostname kafka2 -p 9093:9093 \
  -e KAFKA_NODE_ID=2 \
  -e KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER \
  -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT \
  -e KAFKA_LISTENERS=INTERNAL://kafka2:29092,CONTROLLER://kafka2:29093,EXTERNAL://0.0.0.0:9093 \
  -e KAFKA_ADVERTISED_LISTENERS=INTERNAL://kafka2:29092,EXTERNAL://localhost:9093 \
  -e KAFKA_INTER_BROKER_LISTENER_NAME=INTERNAL \
  -e KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka1:29093,2@kafka2:29093,3@kafka3:29093 \
  -e KAFKA_PROCESS_ROLES=broker,controller \
  -e KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0 \
  -e KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=3 \
  -e KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=3 \
  -e CLUSTER_ID=ciWo7IWazngRchmPES6q5A== \
  -e KAFKA_LOG_DIRS=/tmp/kraft-combined-logs \
  confluentinc/cp-kafka:latest

# Start Kafka broker/controller node #3
podman run -d --name kafka3 --network kafka-net --hostname kafka3 -p 9094:9094 \
  -e KAFKA_NODE_ID=3 \
  -e KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER \
  -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT \
  -e KAFKA_LISTENERS=INTERNAL://kafka3:29092,CONTROLLER://kafka3:29093,EXTERNAL://0.0.0.0:9094 \
  -e KAFKA_ADVERTISED_LISTENERS=INTERNAL://kafka3:29092,EXTERNAL://localhost:9094 \
  -e KAFKA_INTER_BROKER_LISTENER_NAME=INTERNAL \
  -e KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka1:29093,2@kafka2:29093,3@kafka3:29093 \
  -e KAFKA_PROCESS_ROLES=broker,controller \
  -e KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0 \
  -e KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=3 \
  -e KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=3 \
  -e CLUSTER_ID=ciWo7IWazngRchmPES6q5A== \
  -e KAFKA_LOG_DIRS=/tmp/kraft-combined-logs \
  confluentinc/cp-kafka:latest

# Start Kafka UI (detailed, with cluster config)
podman run -d --name kafka-ui --network kafka-net \
  -p 8088:8080 \
  -e DYNAMIC_CONFIG_ENABLED=true \
  -e KAFKA_CLUSTERS_0_NAME="local" \
  -e KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS="kafka1:29092" \
  provectuslabs/kafka-ui